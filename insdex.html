<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taniku - Platform Harga Pangan Nasional</title>
    <meta name="description" content="Pantau harga komoditas pertanian real-time di seluruh Indonesia">
    <meta name="theme-color" content="#22c55e">

    <!-- Fonts & Icons -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obFTR+69w=" crossorigin="" />
    <link rel="manifest" href="manifest.json">

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>

<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loading">
        <div class="loading-logo">ğŸŒ¾</div>
        <h1 class="loading-title">Taniku</h1>
        <div class="loading-bar">
            <div class="loading-bar-fill" id="loading-bar"></div>
        </div>
        <div class="loading-status" id="loading-status">Menginisialisasi...</div>
        <div class="e2ee-badge">ğŸ” End-to-End Encrypted Data</div>
    </div>

    <!-- Main App -->
    <div class="app" id="app">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <span class="logo-icon">ğŸŒ¾</span>
                <span class="logo-text">Taniku</span>
            </div>
            <nav class="nav">
                <div class="nav-item active" data-page="dashboard"><span class="nav-icon">ğŸ“Š</span>Dashboard</div>
                <div class="nav-item" data-page="komoditas"><span class="nav-icon">ğŸŒ¿</span>Komoditas</div>
                <div class="nav-item" data-page="peta"><span class="nav-icon">ğŸ—ºï¸</span>Peta Harga</div>
                <div class="nav-item" data-page="internasional"><span class="nav-icon">ğŸŒ</span>Internasional</div>
                <div class="nav-item" data-page="kalkulator"><span class="nav-icon">ğŸ§®</span>Kalkulator</div>
            </nav>
            <div class="sidebar-footer">
                <div class="sync-status online" id="sync-status">ğŸ”„ <span>Real-time Connected</span></div>
                <div class="location-badge" id="location">ğŸ“ <span>Mendeteksi...</span></div>
                <div class="location-badge" id="api-source-badge"
                    style="cursor:pointer;margin-top:0.5rem;border-color:var(--primary)"
                    title="Klik untuk ganti sumber data">
                    <div id="api-indicator"
                        style="width:8px;height:8px;border-radius:50%;background:#f59e0b;display:inline-block;margin-right:0.5rem">
                    </div>
                    <span id="api-status-text">Cek API...</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <header class="header">
                <div class="header-left">
                    <button class="menu-btn" id="menu-btn">â˜°</button>
                    <h1 class="page-title" id="page-title">Dashboard</h1>
                </div>
                <div class="header-right">
                    <div class="search-box">
                        <input type="text" id="search" placeholder="Cari komoditas...">
                    </div>
                </div>
            </header>

            <!-- Dashboard Page -->
            <section class="page active" id="page-dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“ˆ</div>
                        <div>
                            <div class="stat-value" id="stat-total">0</div>
                            <div class="stat-label">Komoditas</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“Š</div>
                        <div>
                            <div class="stat-value">34</div>
                            <div class="stat-label">Provinsi</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">â¬†ï¸</div>
                        <div>
                            <div class="stat-value" id="stat-up">0</div>
                            <div class="stat-label">Harga Naik</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">â¬‡ï¸</div>
                        <div>
                            <div class="stat-value" id="stat-down">0</div>
                            <div class="stat-label">Harga Turun</div>
                        </div>
                    </div>
                </div>
                <div class="chart-section">
                    <div class="chart-card">
                        <div class="chart-title">ğŸ“ˆ Tren Harga Mingguan</div>
                        <canvas id="weekly-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">ğŸ“Š Distribusi Kategori</div>
                        <canvas id="category-chart"></canvas>
                    </div>
                </div>
                <h3 class="section-title">ğŸ”¥ Pergerakan Terbesar</h3>
                <div class="movers-grid" id="top-movers"></div>
            </section>

            <!-- Komoditas Page -->
            <section class="page" id="page-komoditas">
                <div class="filter-bar">
                    <div class="filter-chips" id="filters"></div>
                </div>
                <div class="commodities-grid" id="commodities-grid"></div>
            </section>

            <!-- Peta Page -->
            <section class="page" id="page-peta">
                <div class="map-page">
                    <div class="map-controls">
                        <select id="map-select">
                            <option value="">Memuat Peta...</option>
                        </select>
                    </div>
                    <div id="map-container"></div>
                    <div class="map-legend">
                        <h4>Tingkat Harga</h4>
                        <div class="legend-item"><span class="legend-color low"></span>Rendah</div>
                        <div class="legend-item"><span class="legend-color medium"></span>Sedang</div>
                        <div class="legend-item"><span class="legend-color high"></span>Tinggi</div>
                    </div>
                </div>
            </section>

            <!-- Internasional Page -->
            <section class="page" id="page-internasional">
                <div class="intl-header">
                    <h2>Perbandingan Harga Internasional</h2>
                    <div class="exchange-rate">1 USD = Rp ...</div>
                </div>
                <div class="intl-grid" id="intl-grid"></div>
            </section>

            <!-- Kalkulator Page -->
            <section class="page" id="page-kalkulator">
                <div class="calc-tabs">
                    <button class="calc-tab active" data-tab="lahan">ğŸŒ¾ Luas Lahan</button>
                    <button class="calc-tab" data-tab="benih">ğŸŒ± Kebutuhan Benih</button>
                    <button class="calc-tab" data-tab="pupuk">ğŸ§ª Kebutuhan Pupuk</button>
                    <button class="calc-tab" data-tab="panen">ğŸ“¦ Estimasi Panen</button>
                    <button class="calc-tab" data-tab="cuaca">ğŸŒ¦ï¸ Cek Cuaca & Tanam</button>
                </div>

                <!-- Panels -->
                <div class="calc-panel active" id="calc-lahan">
                    <div class="calc-form">
                        <h3>ğŸŒ¾ Kalkulator Luas Lahan</h3>
                        <p style="color:var(--text-muted);margin-bottom:1.5rem">Konversi berbagai satuan luas lahan</p>
                        <div class="calc-input"><label>Nilai</label><input type="number" id="lahan-nilai"
                                placeholder="1"></div>
                        <div class="calc-input">
                            <label>Dari Satuan</label>
                            <select id="lahan-dari">
                                <option value="hektar">Hektar (Ha)</option>
                                <option value="are">Are</option>
                                <option value="m2">Meter Persegi (mÂ²)</option>
                                <option value="bata">Bata / Ru (Jawa)</option>
                                <option value="tumbak">Tumbak / Bahu</option>
                                <option value="acre">Acre</option>
                            </select>
                        </div>
                        <button class="calc-btn" id="calc-lahan-btn">Konversi</button>
                        <div class="calc-result" id="lahan-result"></div>
                    </div>
                </div>

                <div class="calc-panel" id="calc-benih">
                    <div class="calc-form">
                        <h3>ğŸŒ± Kalkulator Kebutuhan Benih</h3>
                        <div class="calc-input"><label>Luas Lahan (Ha)</label><input type="number" id="benih-luas"
                                placeholder="1"></div>
                        <div class="calc-input">
                            <label>Jenis Tanaman</label>
                            <select id="benih-jenis">
                                <option value="padi">Padi (25 kg/Ha)</option>
                                <option value="jagung">Jagung (20 kg/Ha)</option>
                                <option value="kedelai">Kedelai (40 kg/Ha)</option>
                                <option value="cabai">Cabai (150 gr/Ha)</option>
                                <option value="tomat">Tomat (200 gr/Ha)</option>
                                <option value="bawang">Bawang Merah (1 ton/Ha)</option>
                                <option value="kentang">Kentang (1.5 ton/Ha)</option>
                            </select>
                        </div>
                        <button class="calc-btn" id="calc-benih-btn">Hitung</button>
                        <div class="calc-result" id="benih-result"></div>
                    </div>
                </div>

                <div class="calc-panel" id="calc-pupuk">
                    <div class="calc-form">
                        <h3>ğŸ§ª Kalkulator Pupuk</h3>
                        <div class="calc-input"><label>Luas Lahan (Ha)</label><input type="number" id="pupuk-luas"
                                placeholder="1"></div>
                        <div class="calc-input">
                            <label>Jenis</label>
                            <select id="pupuk-jenis">
                                <option value="padi">Padi</option>
                                <option value="jagung">Jagung</option>
                                <option value="sayuran">Sayuran</option>
                                <option value="buah">Buah</option>
                                <option value="perkebunan">Perkebunan</option>
                            </select>
                        </div>
                        <button class="calc-btn" id="calc-pupuk-btn">Hitung</button>
                        <div class="calc-result" id="pupuk-result"></div>
                    </div>
                </div>

                <div class="calc-panel" id="calc-panen">
                    <div class="calc-form">
                        <h3>ğŸ“¦ Estimasi Panen</h3>
                        <div class="calc-input"><label>Luas Lahan (Ha)</label><input type="number" id="panen-luas"
                                placeholder="1"></div>
                        <div class="calc-input">
                            <label>Komoditas</label>
                            <select id="panen-jenis">
                                <option value="padi">Padi</option>
                                <option value="jagung">Jagung</option>
                                <option value="kedelai">Kedelai</option>
                                <option value="cabai">Cabai</option>
                                <option value="tomat">Tomat</option>
                                <option value="sawit">Sawit</option>
                            </select>
                        </div>
                        <button class="calc-btn" id="calc-panen-btn">Estimasi</button>
                        <div class="calc-result" id="panen-result"></div>
                    </div>
                </div>

                <!-- NEW: Cuaca Panel -->
                <div class="calc-panel" id="calc-cuaca">
                    <div class="calc-form">
                        <h3>ğŸŒ¦ï¸ Analisis Cuaca & Tanam</h3>
                        <p style="color:var(--text-muted);margin-bottom:1.5rem">Rekomendasi tanam berdasarkan kondisi
                        </p>
                        <div class="calc-input"><label>Curah Hujan (mm/hari)</label><input type="number"
                                id="cuaca-hujan" placeholder="50"></div>
                        <div class="calc-input"><label>Suhu Rata-rata (Â°C)</label><input type="number" id="cuaca-suhu"
                                placeholder="28"></div>
                        <div class="calc-input">
                            <label>Rencana Tanam</label>
                            <select id="cuaca-tanaman">
                                <option value="padi">Padi Sawah</option>
                                <option value="cabai">Cabai Merah</option>
                                <option value="jagung">Jagung</option>
                                <option value="bawang">Bawang Merah</option>
                            </select>
                        </div>
                        <button class="calc-btn" id="calc-cuaca-btn">Analisis Kelayakan</button>
                        <div class="calc-result" id="cuaca-result"></div>
                    </div>
                </div>

            </section>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal" id="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <button class="modal-close" id="modal-close">&times;</button>
            <div class="modal-header">
                <span class="modal-icon" id="modal-icon">ğŸŒ¾</span>
                <h2 class="modal-title" id="modal-title">Detail</h2>
            </div>
            <div class="modal-body">
                <div class="modal-chart"><canvas id="modal-chart"></canvas></div>
                <h3>Sub-Komoditas</h3>
                <div class="sub-commodities" id="sub-list"></div>
            </div>
        </div>
    </div>

    <div class="modal active" id="welcome-modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content" style="max-width:600px">
            <div class="modal-header">
                <span class="modal-icon">ğŸŒ¾</span>
                <h2 class="modal-title">Selamat Datang di Taniku</h2>
            </div>
            <div class="modal-body" style="padding:2rem">
                <h3>Platform Harga Pangan Terintegrasi</h3>
                <p style="color:var(--text-muted);margin:1rem 0">Data real-time dari BPS, Kementan, dan Pasar
                    Internasional.</p>

                <div style="background:var(--bg-primary);padding:1rem;border-radius:10px;margin-bottom:1rem">
                    <div>âœ… 60+ Komoditas Nasional</div>
                    <div>âœ… Analisis Cuaca & Kalkulator Tani</div>
                    <div>âœ… Monitoring Harga Wilayah</div>
                </div>

                <button class="calc-btn" id="welcome-close">Mulai Eksplorasi</button>
            </div>
        </div>
    </div>

    <!-- Modular Scripts -->
    <!-- Libraries -->
    <!-- Load Logic Utils First -->
    <script src="logic.js"></script>
    <script src="api.js"></script>
    <script src="location.js"></script>
    <script src="komoditas.js"></script>
    <script src="ailogic.js"></script>
    <script src="chart.js"></script>
    <script src="kalkulator.js"></script>
    <!-- Main Controller -->
    <script src="script.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(e => console.log('SW Fail:', e));
        }
    </script>
</body>


</html>
